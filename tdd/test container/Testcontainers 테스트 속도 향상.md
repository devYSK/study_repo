https://www.merikan.com/2020/10/speed-up-your-testcontainers-tests/





[ì´ê²ƒì€ Testcontainers](https://www.testcontainers.org/) ì— ëŒ€í•œ ë‘ ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±ëœ ì‹œë¦¬ì¦ˆì˜ ë‘ ë²ˆì§¸ ë¶€ë¶„ì…ë‹ˆë‹¤ . ì´ ë¶€ë¶„ì—ì„œëŠ” ë¬´ì—‡ë³´ë‹¤ë„ Testcontainerë¥¼ í›¨ì”¬ ë¹ ë¥´ê²Œ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ìš”ë ¹ì„ ë³´ì—¬ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

# ì†Œê°œ

ì´ì „ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì¸ [Getting Started with Testcontainers ì—ì„œ ](https://merikan.com/2020/10/getting-started-with-testcontainers/)[Testcontainers](https://www.testcontainers.org/) í”„ë ˆì„ì›Œí¬ê°€ ë¬´ì—‡ ì´ê³  í”„ë¡œì íŠ¸ì—ì„œ ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. Testcontainersë¥¼ ì˜¤ë«ë™ì•ˆ ì‚¬ìš©í•˜ë©´ì„œ ë” ì¢‹ê³  ë” ë¹ ë¥´ê²Œ ë§Œë“¤ê¸° ìœ„í•´ ì¡°ì •í•´ì•¼ í•  ì‚¬í•­ì´ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œëŠ” í™˜ìƒì ì¸ í”„ë ˆì„ì›Œí¬ë¥¼ í›¨ì”¬ ë” ì¢‹ê²Œ ë§Œë“œëŠ” ëª‡ ê°€ì§€ ì‚¬í•­ì„ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

## ì†ŒìŠ¤ ì½”ë“œ

ë‚´ ì˜ˆì œ í”„ë¡œì íŠ¸ì˜ ì „ì²´ ì†ŒìŠ¤ ì½”ë“œëŠ” [https://github.com/merikan/testcontainers-demo)](https://github.com/merikan/testcontainers-demo) ë° í´ë” ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ `faster`.

# ì‹±ê¸€í†¤ íŒ¨í„´ ì‚¬ìš©

[ì´ì „ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼](https://merikan.com/2020/10/getting-started-with-testcontainers/) ì—ì„œ ì´ì— ëŒ€í•´ ì„¤ëª… í–ˆì§€ë§Œ ë°˜ë³µí•  ê°€ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤. `@Container`ë•Œë¡œëŠ” í†µí•© í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì—ì„œ Testcontainerë¥¼ ì„ ì–¸í•˜ê¸° ìœ„í•´ ì£¼ì„ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ . ì´ê²ƒì˜ ë‹¨ì ì€ í…ŒìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë˜ëŠ” ê° í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ì‚¬ì´ì—ì„œ ì‹œì‘ ë° ì¤‘ì§€ë˜ì–´ ë§¤ìš° ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ëŒ€ì‹  ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ Testcontainerê°€ ëª¨ë“  í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì— ëŒ€í•´ í•œ ë²ˆë§Œ ì‹œì‘í•˜ê³  ì™„ë£Œë˜ë©´ ì¤‘ë‹¨ë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ëª¨ë“  ë¶€ì‘ìš©ì„ ì²˜ë¦¬í•´ì•¼ í•œë‹¤ëŠ” ì ì„ ëª…ì‹¬í•˜ì‹­ì‹œì˜¤. ì˜ˆë¥¼ ë“¤ì–´ ë¦¬ì†ŒìŠ¤ ìƒíƒœì— ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê±°ë‚˜ ê° í…ŒìŠ¤íŠ¸ì— ëŒ€í•´ ì›í•˜ëŠ” ìƒíƒœë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ Testcontainer ìƒì„±ì„ ì²˜ë¦¬í•˜ëŠ” ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
@SpringBootTest(webEnvironment = RANDOM_PORT)
@ActiveProfiles("integrationtest")
public abstract class AbstractIntegrationTest {
    private static final DockerImageName MARIADB_IMAGE = DockerImageName.parse("mariadb:10.5.5");
    private static final MariaDBContainer mariadb;

    static {
        mariadb = new MariaDBContainer<>(MARIADB_IMAGE)
            .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci");
        mariadb.start();
    }

    @DynamicPropertySource
    static void properties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", mariadb::getJdbcUrl);
        registry.add("spring.datasource.username", mariadb::getUsername);
        registry.add("spring.datasource.password", mariadb::getPassword);
    }
}
```

ê·¸ëŸ° ë‹¤ìŒ ê° í†µí•© í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ëŠ” ì´ ì¶”ìƒ í´ë˜ìŠ¤ì—ì„œ ìƒì†í•˜ì—¬ Testcontainersë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```java
public class TodoServiceImplIT extends AbstractIntegrationTest {

    @Autowired
    private TodoService uut;

    @Autowired
    private TodoRepository repository;

    @BeforeEach
    public void setUp() throws Exception {
        repository.deleteAll();
    }
```

ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ Testcontainerê°€ í•œ ë²ˆë§Œ ì‹œì‘ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ì‹œê°„ì´ í¬ê²Œ ë‹¨ì¶•ë©ë‹ˆë‹¤.

# ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¡œ ì‹œì‘ ì‹œê°„ ë‹¨ì¶•

í˜„ì¬ í”„ë¡œì íŠ¸ì—ëŠ” í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ì— ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆê°€ ìˆìœ¼ë©° í•œ ë²ˆë§Œ ì™„ë£Œí•˜ë”ë¼ë„ ì‹œì‘í•˜ëŠ” ë° ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì•½ê°„ì˜ ë³€ê²½ìœ¼ë¡œ ì‹œì‘ ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¨¼ì € ì—¬ëŸ¬ Testcontainerë¥¼ ì‹œì‘í•˜ëŠ” ì˜ˆì œë¥¼ ë§Œë“  ë‹¤ìŒ ì‹œì‘ ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì¼ë¶€ ë³€ê²½ì„ ìˆ˜í–‰í•˜ê² ìŠµë‹ˆë‹¤. ì˜ëª»ëœ ê²°ê³¼ë¥¼ ì–»ì§€ ì•Šìœ¼ë ¤ë©´ ëª¨ë“  ì´ë¯¸ì§€ë¥¼ í’€ë‹¤ìš´í•˜ê³  ë¡œì»¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë¨¼ì € í•œ ë²ˆ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆì œë¥¼ ê¹¨ë—í•˜ê³  ëª…í™•í•˜ê²Œ ìœ ì§€í•˜ê¸° ìœ„í•´ ì‹œì‘ëœ ì»¨í…Œì´ë„ˆì˜ ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```java
static {
    Instant start = Instant.now();

    mariadb1 = new MariaDBContainer<>(MARIADB_IMAGE)
        .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci");
    mariadb1.start();
    mariadb2 = new MariaDBContainer<>(MARIADB_IMAGE)
        .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci");
    mariadb2.start();
    redis = new GenericContainer<>(REDIS_IMAGE).withExposedPorts(6379);
    redis.start();
    kafka = new KafkaContainer(KAFKA_IMAGE);
    kafka.start();
    sftp = new GenericContainer<>(SFTP_IMAGE)
        .withCommand(String.format("%s:%s:::upload", "SFTP_USER", "SFTP_PASSWORD"));
    sftp.start();

    log.info("ğŸ³ TestContainers started in {}", Duration.between(start, Instant.now()));
    
}
```

ì´ì œ í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ 5ê°œì˜ Testcontainerë¥¼ ëª¨ë‘ ì‹œì‘í•˜ëŠ” ë° 30ì´ˆë„ ì±„ ê±¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
 ğŸ³ TestContainers started in PT29.836S 
```

ì´ì œ ëª‡ ê°€ì§€ ì‚¬í•­ì„ ë³€ê²½í•  ì‹œê°„ì…ë‹ˆë‹¤. ìœ„ì˜ ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ í…ŒìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹œì‘í•˜ê³  ìˆìŠµë‹ˆë‹¤. ëŒ€ì‹  ë³‘ë ¬ë¡œ ì‹œì‘í•  ìˆ˜ ìˆë‹¤ë©´ ì–´ë–¨ê¹Œìš”? ì‹œë„í•´ ë´…ì‹œë‹¤. ì´ë¥¼ ìœ„í•´ Stream í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ë‹¤ìŒê³¼ ê°™ì´ í‘œì‹œë©ë‹ˆë‹¤.

```java
static {
    Instant start = Instant.now();

    mariadb1 = new MariaDBContainer<>(MARIADB_IMAGE)
        .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci");
    mariadb2 = new MariaDBContainer<>(MARIADB_IMAGE)
        .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci");
    redis = new GenericContainer<>(REDIS_IMAGE).withExposedPorts(6379);
    kafka = new KafkaContainer(KAFKA_IMAGE);
    sftp = new GenericContainer<>(SFTP_IMAGE)
        .withCommand(String.format("%s:%s:::upload", "SFTP_USER", "SFTP_PASSWORD"));
    Stream.of(mariadb1, mariadb2, redis, kafka, sftp).parallel().forEach(GenericContainer::start);

    log.info("ğŸ³ TestContainers started in {}", Duration.between(start, Instant.now()));
}
```

ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ 5ê°œì˜ Testcontainerë¥¼ ëª¨ë‘ ì‹œì‘í•˜ëŠ” ë° 12ì´ˆë„ ì±„ ê±¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
 ğŸ³ TestContainers started in PT11.606S
```

ê·¸ë˜ì„œ ì‹œì‘ ì‹œê°„ì„ 18ì´ˆ ë‹¨ì¶•í–ˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê²Œ ë‚˜ì˜ì§€ëŠ” ì•Šì£ ? í…ŒìŠ¤íŠ¸ë¥¼ ë” ë¹ ë¥´ê²Œ í•˜ê¸° ìœ„í•´ í•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ ë°©ë²•ì´ ìˆìŠµë‹ˆê¹Œ? ì˜ˆ, ìˆìŠµë‹ˆë‹¤. ê³„ì† ì½ìœ¼ë©´ ë˜ ë‹¤ë¥¸ ë°©ë²•ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# í…ŒìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ ì¬ì‚¬ìš©

ë°˜ë³µì ìœ¼ë¡œ ì†ë„ë¥¼ ì €í•˜ì‹œí‚¤ëŠ” í•œ ê°€ì§€ëŠ” í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ë¡œ ì‘ì—…í•˜ê³  ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œì…ë‹ˆë‹¤. ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìœ¼ë©° ë¹ ë¥¸ í”¼ë“œë°± ë£¨í”„ë¥¼ ì›í•©ë‹ˆë‹¤. ê·¸ëŸ¼ ì¢€ ë” ê¹Šì´ íŒŒê³ ë“¤ì–´ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë´…ì‹œë‹¤.

Testcontainersì—ëŠ” ì´ë¯¸ ì‹œì‘ëœ Testcontainerë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” [ë¯¸ë¦¬ ë³´ê¸° ê¸°ëŠ¥ ì´ ìˆìŠµë‹ˆë‹¤. ](https://github.com/testcontainers/testcontainers-java/pull/1781)ì¦‰, Ryuk(í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ Testcontainerë¥¼ ì¢…ë£Œí•˜ëŠ” ì •ë¦¬ ë©”ì»¤ë‹ˆì¦˜)ê°€ ì‹œì‘ë˜ì§€ ì•Šìœ¼ë©°, ì´ëŠ” í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œëœ í›„ì—ë„ Testcontainerê°€ ì¤‘ë‹¨ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ ê°œë°œ ê³¼ì •ì—ì„œ ì‹œê°„ì„ ì •ë§ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ê¸°ì–µí•´ì•¼ í•  ê²ƒì€ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ëª¨ë“  Testcontainerë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¤‘ì§€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì´ ì¬ì‚¬ìš©ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ë ¤ë©´ ë‘ ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ë¨¼ì € ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Testcontainerì— ì¬ì‚¬ìš©í•´ì•¼ í•œë‹¤ê³  ì•Œë ¤ì•¼ í•©ë‹ˆë‹¤ `.withReuse(true)`. `~/.testcontainers.properties`ë‹¤ìŒìœ¼ë¡œ í™ˆ ë””ë ‰í„°ë¦¬ì— Testcontainers()ì— ëŒ€í•œ êµ¬ì„± íŒŒì¼ì„ ë§Œë“¤ê³  ì†ì„±ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤ `testcontainers.reuse.enable=true`. ì‘ì„± ì‹œì ì— ì´ ì†ì„± íŒŒì¼ì€ í”„ë¡œì íŠ¸ë‹¹ í´ë˜ìŠ¤ ê²½ë¡œê°€ ì•„ë‹Œ í™ˆ ë””ë ‰í† ë¦¬ì—ë§Œ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¤ë¥¸ í•œí¸ìœ¼ë¡œëŠ” íŒ€ êµ¬ì„±ì›ì´ë‚˜ CI/CD íŒŒì´í”„ë¼ì¸ê³¼ ê°™ì€ ë‹¤ë¥¸ í™˜ê²½ì— ì´ëŸ¬í•œ ë™ì‘ì„ ê°•ìš”í•˜ê³  ì‹¶ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì´ê²ƒì€ ë°˜ë“œì‹œ ì„ íƒ ì‚¬í•­ì´ì–´ì•¼ í•˜ë©° í”„ë¡œì íŠ¸ë³„ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ ë˜ë©´ `.gitignore`ë™ë£Œ ë° CI/CD íŒŒì´í”„ë¼ì¸ì— ì „íŒŒë˜ì§€ ì•Šë„ë¡ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

í™œì„±í™”í•  ë•Œ ì¶”ìƒ í´ë˜ìŠ¤ê°€ ë‹¤ìŒê³¼ ê°™ì´ í‘œì‹œë©ë‹ˆë‹¤ `reuse`.

```java
static {
    Instant start = Instant.now();

    mariadb1 = new MariaDBContainer<>(MARIADB_IMAGE)
        .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci")
        .withReuse(true);
    mariadb2 = new MariaDBContainer<>(MARIADB_IMAGE)
        .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci")
        .withReuse(true);
    redis = new GenericContainer<>(REDIS_IMAGE)
        .withExposedPorts(6379)
        .withReuse(true);
    kafka = new KafkaContainer(KAFKA_IMAGE)
        .withReuse(true);
    sftp = new GenericContainer<>(SFTP_IMAGE)
        .withCommand(String.format("%s:%s:::upload", "SFTP_USER", "SFTP_PASSWORD"))
        .withReuse(true);
    Stream.of(mariadb1, mariadb2, redis, kafka, sftp).parallel().forEach(GenericContainer::start);

    log.info("ğŸ³ TestContainers started in {}", Duration.between(start, Instant.now()));
}
```

ì•„ë§ˆë„ ì§ë©´í•˜ê²Œ ë  í•œ ê°€ì§€ [ë¬¸ì œ](https://github.com/testcontainers/testcontainers-java/issues/2961) ëŠ” Testcontainerê°€ ì´ íŠ¹ì • í”„ë¡œì íŠ¸ì— ê³ ìœ í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì— ë™ì¼í•œ êµ¬ì„±ì„ ê°€ì§„ ì—¬ëŸ¬ Testcontainerê°€ ìˆê¸° ë•Œë¬¸ì— ì´ê²ƒì€ ë‚˜ì—ê²Œ ì‹¤ì§ˆì ì¸ ë¬¸ì œë¥¼ ì œê¸°í–ˆìŠµë‹ˆë‹¤. ì´ê²ƒì„ ìˆ˜ì •í•©ì‹œë‹¤.

[ì†ŒìŠ¤ ì½”ë“œ](https://github.com/testcontainers/testcontainers-java/blob/17b4f6c136f6f2c7dc223bad407221f62a8f0088/core/src/main/java/org/testcontainers/containers/GenericContainer.java#L364-L412) ë¥¼ ì‚´í´ë³´ë©´ ì‹œì‘ëœ Testcontainerì˜ ê³ ìœ ì„±ì€ ì‹¤ì œ êµ¬ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤. TestcontainersëŠ” ë ˆì´ë¸”ì´ ìˆëŠ” í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  ì»¨í…Œì´ë„ˆ ì¤‘ì—ì„œ í•´ì‹œë¥¼ ê²€ìƒ‰ `org.testcontainers.hash`í•˜ì—¬ ì¼ì¹˜í•˜ëŠ” í•­ëª©ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì¼ì¹˜í•˜ëŠ” ê²½ìš° ì´ ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ë¬¸ì œì— ëŒ€í•œ ì‰¬ìš´ í•´ê²°ì±…ì€ ì´ íŠ¹ì • ì»¨í…Œì´ë„ˆë¥¼ ê³ ìœ í•˜ê²Œ ë§Œë“œëŠ” êµ¬ì„±ì— ë¬´ì–¸ê°€ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. [ê°’ìœ¼ë¡œ ê³ ìœ í•œ UUID](https://www.uuidgenerator.net/)`reuse.UUID` ê°€ ìˆëŠ” ì´ë¦„ ì„ ì‚¬ìš©í•˜ì—¬ ë‚˜ë§Œì˜ ë ˆì´ë¸”ì„ ì¶”ê°€í•˜ë„ë¡ ì„ íƒí–ˆìŠµë‹ˆë‹¤ .

```java
.withLabel("reuse.UUID", "e06d7a87-7d7d-472e-a047-e6c81f61d2a4");
```

ì´ê²ƒì€ Testcontainerì— ëŒ€í•œ ê³ ìœ  IDë¡œ ì¬ì‚¬ìš©ì„ í™œì„±í™”í•  ë•Œ ì¶”ìƒ í´ë˜ìŠ¤ì—ì„œ ë³´ì´ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤.

```java
static {
    Instant start = Instant.now();

    mariadb1 = new MariaDBContainer<>(MARIADB_IMAGE)
        .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci")
        .withReuse(true)
        .withLabel("reuse.UUID", "e06d7a87-7d7d-472e-a047-e6c81f61d2a4");
    mariadb2 = new MariaDBContainer<>(MARIADB_IMAGE)
        .withCommand("--character-set-server=utf8mb4", "--collation-server=utf8mb4_unicode_ci")
        .withReuse(true)
        .withLabel("reuse.UUID", "282b8993-097c-4fd4-98f1-94daf3466dd6");
    redis = new GenericContainer<>(REDIS_IMAGE)
        .withExposedPorts(6379)
        .withReuse(true)
        .withLabel("reuse.UUID", "0429783b-c855-4b32-8239-258cba232b63");
    kafka = new KafkaContainer(KAFKA_IMAGE)
        .withReuse(true)
        .withLabel("reuse.UUID", "f8724ec0-2f66-4684-80cd-1b24a7399366");
    sftp = new GenericContainer<>(SFTP_IMAGE)
        .withCommand(String.format("%s:%s:::upload", "SFTP_USER", "SFTP_PASSWORD"))
        .withReuse(true)
        .withLabel("reuse.UUID", "0293a405-e435-4f03-9e4b-b6160d9e60fe");
    Stream.of(mariadb1, mariadb2, redis, kafka, sftp).parallel().forEach(GenericContainer::start);

    log.info("ğŸ³ TestContainers started in {}", Duration.between(start, Instant.now()));
}
```

í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ì»¨í…Œì´ë„ˆë¥¼ ì²˜ìŒ ì‹œì‘í•˜ëŠ” ë° ì•½ 11ì´ˆê°€ ê±¸ë ¸ìŠµë‹ˆë‹¤. ì´ì œ Testcontainerê°€ ì¬ì‚¬ìš©ë˜ë©° ì´ë²ˆì—ëŠ” ì•½ 1ì´ˆë§Œ ê±¸ë¦½ë‹ˆë‹¤. ë‚˜ì˜ì§€ ì•Šì£ ?

```
 ğŸ³ TestContainers started in PT1.796S
```

ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ë•Œ ë” ë¹ ë¥¸ í”¼ë“œë°±ì„ ì–»ì„ ìˆ˜ ìˆëŠ” ì„±ëŠ¥ í–¥ìƒì…ë‹ˆë‹¤. ì´ì œ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ì‹¤í–‰ ì¤‘ì¸ Testcontainerë¥¼ ì¤‘ì§€í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  Testcontainerë¥¼ ë‚˜ì—´í•˜ë ¤ë©´:

```sh
$ docker ps --filter label=org.testcontainers
CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS              PORTS                                                                       NAMES
e1ccf87be0f2        mariadb:10.5.5                "docker-entrypoint.sâ€¦"   3 minutes ago       Up 3 minutes        0.0.0.0:32969->3306/tcp                                                     adoring_pascal
bed6d13ccf33        atmoz/sftp                    "/entrypoint SFTP_USâ€¦"   3 minutes ago       Up 3 minutes        0.0.0.0:32967->22/tcp                                                       serene_driscoll
4732e1e5144b        confluentinc/cp-kafka:5.2.1   "sh -c 'while [ ! -fâ€¦"   3 minutes ago       Up 3 minutes        0.0.0.0:32968->2181/tcp, 0.0.0.0:32966->9092/tcp, 0.0.0.0:32965->9093/tcp   tender_wright
dae6f7e12707        redis:5.0.5                   "docker-entrypoint.sâ€¦"   3 minutes ago       Up 3 minutes        0.0.0.0:32964->6379/tcp                                                     epic_goldberg
58442bb5df71        mariadb:10.5.5                "docker-entrypoint.sâ€¦"   3 minutes ago       Up 3 minutes        0.0.0.0:32970->3306/tcp                                                     heuristic_varahamihira
```

ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  Testcontainerë¥¼ ì¤‘ì§€í•˜ë ¤ë©´:

```sh
$  docker stop $(docker ps -q --filter label=org.testcontainers)
e1ccf87be0f2
bed6d13ccf33
4732e1e5144b
dae6f7e12707
58442bb5df71
```

# ë„ì»¤ ì»¨í…Œì´ë„ˆì—ì„œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

ìì£¼ ì œê¸°ë˜ëŠ” í•œ ê°€ì§€ ì§ˆë¬¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ê°€ ì´ì œ ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° í…ŒìŠ¤íŠ¸ ìì²´ê°€ ë„ì»¤ ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆê¹Œ? ì˜ˆ, ê°€ëŠ¥í•©ë‹ˆë‹¤ . [Dockerì—ì„œëŠ” Docker](https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/) ë¼ê³ ë„ í•©ë‹ˆë‹¤. DinD. docker in dockerë¥¼ ì‚¬ìš©í•˜ë©´ ê¶Œí•œ ëª¨ë“œ ë“±ê³¼ ê°™ì€ ìƒˆë¡œìš´ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆì§€ë§Œ ì—¬ê¸°ì—ì„œ ë‹¤ë£¨ë ¤ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.

Docker ì»¨í…Œì´ë„ˆì—ì„œ ë¡œì»¬ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```sh
$ git clone https://github.com/merikan/testcontainers-demo.git
$ cd testcontainers-demo/faster
faster $  docker run -it --rm -v $PWD:$PWD -w $PWD -v /var/run/docker.sock:/var/run/docker.sock maven:3 ./mvnw clean test verify
```

[ì—¬ê¸°](https://www.testcontainers.org/supported_docker_environment/continuous_integration/dind_patterns) ì—ì„œ Dockerì˜ Testcontainers ë° Dockerì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ .

# ìš”ì•½

ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì—ì„œëŠ” Testcontainersë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ì‹œê°„ì„ í¬ê²Œ ì¤„ì´ëŠ” ëª‡ ê°€ì§€ ë°©ë²•ì„ ë³´ì—¬ ì£¼ì—ˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ;
ë‚˜ëŠ” ë‹¨ì§€ ì¸ê°„ì…ë‹ˆë‹¤. ëª¨í˜¸í•¨, ì˜¤íƒ€, ì˜¤ë¥˜ ë˜ëŠ” ê°€ëŠ¥í•œ ê°œì„  ì‚¬í•­ì´ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì‹­ì‹œì˜¤.
ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì´ ë§ˆìŒì— ë“¤ë©´ ëŒ“ê¸€ì„ ì¶”ê°€í•˜ê³  ì¢‹ì•„í•˜ëŠ” ì†Œì…œ ë¯¸ë””ì–´ í”Œë«í¼ì„ ì‚¬ìš©í•˜ì—¬ ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì„ ììœ ë¡­ê²Œ ê³µìœ í•˜ì„¸ìš”! ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ì— ëª‡ ê°€ì§€ ì•„ì´ì½˜ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒ ì‹œê°„ê¹Œì§€ ì½”ë”©ì„ ê³„ì†í•˜ê³  ìƒˆë¡œìš´ ê²ƒì„ ë°°ìš°ëŠ” ê²ƒì„ ë©ˆì¶”ì§€ ë§ˆì„¸ìš”!

## ìì›

- [Java í”„ë¡œì íŠ¸](https://github.com/testcontainers/testcontainers-java/) ìš© Testcontainers [í™ˆí˜ì´ì§€](https://www.testcontainers.org/) ë° ì†ŒìŠ¤ ì½”ë“œ
- ë‚´ ì˜ˆì œ í”„ë¡œì íŠ¸ì˜ ì „ì²´ ì†ŒìŠ¤ ì½”ë“œëŠ” [https://github.com/merikan/testcontainers-demo)](https://github.com/merikan/testcontainers-demo) ë° í´ë” ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ `faster`.