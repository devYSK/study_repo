## 7ì¥ ê³ ê¸‰ ë§¤í•‘

<br>

### âœ… 7.1 ìƒì† ê´€ê³„ ë§¤í•‘

ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ê°ì²´ì§€í–¥ ì–¸ì–´ì—ì„œ ë‹¤ë£¨ëŠ” ìƒì†ì´ë¼ëŠ” ê°œë…ì´ ì—†ë‹¤. <br>
ëŒ€ì‹  ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„(Super-Type Sub-Type Relationship)ë¼ëŠ” ëª¨ë¸ë§ ê¸°ë²•ì´ ê°ì²´ì˜ ìƒì† ê°œë…ê³¼ ê°€ì¥ ìœ ì‚¬í•˜ë‹¤. <br>


* [ìŠˆí¼íƒ€ì…, ì„œë¸Œíƒ€ì… ê´€ë ¨ í¬ìŠ¤íŒ…](https://0soo.tistory.com/46)


<img width="60%" src="https://s1.md5.ltd/image/f4dbec485491972d678caee07719f2a6.png">

<br>

ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ë…¼ë¦¬ ëª¨ë¸ì„ ì‹¤ì œ ë¬¼ë¦¬ ëª¨ë¸ì¸ í…Œì´ë¸”ë¡œ êµ¬í˜„í•  ë•ŒëŠ” 3ê°€ì§€ ë°©ë²•ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤. <br>

1. `(ì¡°ì¸ ì „ëµ)` : ê°ê°ì˜ í…Œì´ë¸”ë¡œ ë³€í™˜ - ëª¨ë‘ í…Œì´ë¸”ë¡œ ë§Œë“¤ê³  ì¡°íšŒí•  ë•Œ ì¡°ì¸ì„ ì‚¬ìš© 
2. `ë‹¨ì¼ í…Œì´ë¸” ì „ëµ` : í†µí•© í…Œì´ë¸”ë¡œ ë³€í™˜ - í…Œì´ë¸”ì„ í•˜ë‚˜ë§Œ ì‚¬ìš©í•´ì„œ í†µí•© 
3. `êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ì˜ í…Œì´ë¸” ì „ëµ` : ì„œë¸Œíƒ€ì… í…Œì´ë¸”ë¡œ ë³€í™˜ - ì„œë¸Œ íƒ€ì…ë§ˆë‹¤ í•˜ë‚˜ì˜ í…Œì´ë¸”ì„ ì¶”ê°€í•œë‹¤. 

## ğŸ”¸ 7.1.1 ì¡°ì¸ ì „ëµ (JOINED)

  
* ì¡°ì¸ ì „ëµì€ ì—”í‹°í‹° ê°ê°ì„ ëª¨ë‘ í…Œì´ë¸”ë¡œ ë§Œë“¤ê³  ìì‹ í…Œì´ë¸”ì´ ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤ë¥¼ ë°›ì•„ì„œ ê¸°ë³¸ í‚¤ + ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•˜ëŠ” ì „ëµì´ë‹¤.   
    
    * ë”°ë¼ì„œ ì¡°íšŒí•  ë•Œ ì¡°ì¸ì„ ìì£¼ ì‚¬ìš©í•œë‹¤.   

    * ì´ ì „ëµì„ ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•  ì ì´ ìˆëŠ”ë° ê°ì²´ëŠ” íƒ€ì…ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆì§€ë§Œ í…Œì´ë¸”ì€ íƒ€ì…ì˜ ê°œë…ì´ ì—†ë‹¤.   
    * ê·¸ëŸ¬ë¯€ë¡œ, í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì„ êµ¬ë¶„í•  íƒ€ì… ë°ì´í„°ê°€ í•„ìš”í•˜ë‹¤.   

* íƒ€ì…ì„ êµ¬ë¶„í•˜ëŠ” ì»¬ëŸ¼ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤. 
    * Enum ë“±ì„ ì´ìš©í•  ìˆ˜ ìˆë‹¤.
    * ì—¬ê¸°ì„œëŠ” DTYPE ì»¬ëŸ¼ì„ êµ¬ë¶„ ì»¬ëŸ¼ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. 

<img width="50%" src="https://velog.velcdn.com/images%2Fcham%2Fpost%2F53e6d766-f2d8-4595-aeb7-ccd4cbdd9bb6%2Fimage.png">

```java
@Entity
@Inheritance(strategy = InheritanceType.JOINED)
@DiscriminatorColumn(name = "DTYPE")
public abstract class Item {
    @Id @GeneratedValue
    @Column(name = "ITEM_ID")
    private Long id;
    
    private String name;
    private int price;
}

@Entity
@DiscriminatorValue("A")
public class Album extends Item {
    private String artist;
}

@Entity
@DiscriminatorValue("M")
public class Movie extends Item {
    private String director;
    private String actor;
}
```

<br>

### @Inheritance ì–´ë…¸í…Œì´ì…˜
* ìƒì† ë§¤í•‘ (ìƒì†ë°›ëŠ” ì—”í‹°í‹°ë“¤ì´ ë°›ì„ ì˜µì…˜ë“¤)ì€ ë¶€ëª¨ í´ë˜ìŠ¤ì— @Inheritance ì–´ë…¸í…Œì´ì…˜ì„ ë‹¬ì•„ì•¼ í•œë‹¤. 

#### @Inheritance ì–´ë…¸í…Œì´ì…˜ì˜ ì˜µì…˜ë“¤ - ìƒì† ë§¤í•‘ ì „ëµ
* `@Inheritance(strategy = InheritanceType.JOINED)` 
    * `InheritanceType.JOINED` : ì¡°ì¸ ì „ëµì‹œ ì‚¬ìš©  
        * í•˜ìœ„ í´ë˜ìŠ¤ì— íŠ¹ì •í•œ í•„ë“œë¥¼ ìƒìœ„ í´ë˜ìŠ¤ì— ê³µí†µëœ í•„ë“œì™€ ë³„ë„ì˜ í…Œì´ë¸”ì— ë§¤í•‘í•˜ê³  ì¡°ì¸ì„ ìˆ˜í–‰í•˜ì—¬ í•˜ìœ„ í´ë˜ìŠ¤ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•˜ëŠ” ì „ëµ
    * `InheritanceType.TABLE_PER_CLASS` : ìƒìœ„ ì—”í‹°í‹°ì˜ ê³µí†µ ì†ì„±ë“¤ì„ ëª¨ë‘ í•˜ìœ„ ì—”í‹°í‹°ë¡œ ë‚´ë ¤ ê°ê°ì˜ í…Œì´ë¸”ë¡œ ë§Œë“œëŠ” ì „ëµ
    * `InheritanceType.SINGLE_TABLE` : í…Œì´ë¸”ì„ í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ê³ , êµ¬ë¶„ ì»¬ëŸ¼(DTYPE)ìœ¼ë¡œ ì–´ë–¤ ìì‹ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆëŠ”ì§€ êµ¬ë¶„
        * default ì „ëµ 

* `@DiscriminatorColumn(name = "DTYPE")`
    * ë¶€ëª¨ í´ë˜ìŠ¤ì— êµ¬ë¶„ ì»¬ëŸ¼ì„ ì§€ì •í•œë‹¤. ì´ ì»¬ëŸ¼ìœ¼ë¡œ ì €ì¥ëœ ìì‹ í…Œì´ë¸”ì„ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤. 
    * ê¸°ë³¸ê°’ì´ DTYPE ì´ë¯€ë¡œ `@DiscriminatorColumn`ìœ¼ë¡œ ì¤„ì—¬ ì‚¬ìš©í•´ë„ ëœë‹¤.

* `@DiscriminatorValue("M")` 
    * ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ êµ¬ë¶„ ì»¬ëŸ¼ì— ì…ë ¥í•  ê°’ì„ ì§€ì •í•œë‹¤. 
    * ë§Œì•½ ì˜í™” ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ë©´ êµ¬ë¶„ ì»¬ëŸ¼ì¸ DTYPEì— ê°’ Mì´ ì €ì¥ëœë‹¤.

ê¸°ë³¸ê°’ìœ¼ë¡œ ìì‹ í…Œì´ë¸”ì€ ë¶€ëª¨ í…Œì´ë¸”ì˜ ID ì»¬ëŸ¼ëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ”ë°, ë§Œì•½ ìì‹ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ëª…ì„ ë³€ê²½í•˜ê³  ì‹¶ìœ¼ë©´ ìì‹ í…Œì´ë¸”ì—ì„œ `@PrimaryKeyJoinColumn ì–´ë…¸í…Œì´ì…˜`ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤. <br>

```java
@Entity
@DiscriminatorValue("B")
@PrimaryKeyJoinColumn(name = "BOOK_ID")
public class Book extends Item {
    private String author;
    private String isbn;
}
```

* ì¥ì 
  - í…Œì´ë¸”ì´ ì •ê·œí™”ëœë‹¤.
  - ì™¸ë˜ í‚¤ ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤.
  - ì €ì¥ê³µê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

* ë‹¨ì 
  - ì¡°íšŒí•  ë•Œ ì¡°ì¸ì´ ë§ì´ ì‚¬ìš©ë˜ë¯€ë¡œ ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìˆë‹¤.
  - ì¡°íšŒ ì¿¼ë¦¬ê°€ ë³µì¡í•˜ë‹¤.
  - ë°ì´í„°ë¥¼ ë“±ë¡í•  INSERT SQLì„ ë‘ ë²ˆ ì‹¤í–‰í•œë‹¤.

* íŠ¹ì§•
  - JPA í‘œì¤€ ëª…ì„¸ëŠ” êµ¬ë¶„ ì»¬ëŸ¼ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ì§€ë§Œ, í•˜ì´ë²„ë„¤ì´íŠ¸ë¥¼ í¬í•¨í•œ ëª‡ëª‡ êµ¬í˜„ì²´ëŠ” êµ¬ë¶„ ì»¬ëŸ¼(`@DiscriminatorColumn`)ì—†ì´ ë™ì‘í•œë‹¤.


<br>

### ğŸ”¸ 7.1.2 ë‹¨ì¼ í…Œì´ë¸” ì „ëµ (SINGLE_TABLE)

ë‹¨ì¼ í…Œì´ë¸” ì „ëµì€ ì´ë¦„ ê·¸ëŒ€ë¡œ í…Œì´ë¸”ì„ í•˜ë‚˜ë§Œ ì‚¬ìš©í•œë‹¤.  
ê·¸ë¦¬ê³  êµ¬ë¶„ ì»¬ëŸ¼ìœ¼ë¡œ ì–´ë–¤ ìì‹ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆëŠ”ì§€ êµ¬ë¶„í•œë‹¤. <br>
ì¡°íšŒí•  ë•Œ ì¡°ì¸ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ ê°€ì¥ ë¹ ë¥´ë‹¤. <br>

<img width="35%" src="https://velog.velcdn.com/images%2Fcham%2Fpost%2F55a73a0e-dc74-41dd-bbe2-3dfe39f64414%2Fimage.png">

<br>

ì´ ì „ëµì„ ì‚¬ìš©í•  ë•Œ ì£¼ì˜ì ì€ ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ì€ ëª¨ë‘ nullì„ í—ˆìš©í•´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤. <br>

```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "DTYPE")
public abstract class Item {
    @Id @GeneratedValue
    @Column(name = "ITEM_ID")
    private Long id;
    
    private String name;
    private int price;
}

@Entity
@DiscriminatorValue("A")
public class Album extends Item {}

@Entity
@DiscriminatorValue("M")
public class Movie extends Item {}

@Entity
@DiscriminatorValue("B")
public class Book extends Item {}
```

<br>

`InheritanceType.SINGLE_TABLE`ë¡œ ì§€ì •í•˜ë©´ ë‹¨ì¼ í…Œì´ë¸” ì „ëµì„ ì‚¬ìš©í•œë‹¤. <br>

* ì¥ì 
  - ì¡°ì¸ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ì´ ë¹ ë¥´ë‹¤.
  - ì¡°íšŒ ì¿¼ë¦¬ê°€ ë‹¨ìˆœí•˜ë‹¤.

* ë‹¨ì 
  - ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ì€ ëª¨ë‘ nullì„ í—ˆìš©í•´ì•¼ í•œë‹¤.
  - ë‹¨ì¼ í…Œì´ë¸”ì— ëª¨ë“  ê²ƒì„ ì €ì¥í•˜ë¯€ë¡œ í…Œì´ë¸”ì´ ì»¤ì§ˆ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ìƒí™©ì— ë”°ë¼ì„œëŠ” ì¡°íšŒ ì„±ëŠ¥ì´ ì˜¤íˆë ¤ ëŠë ¤ì§ˆ ìˆ˜ ìˆë‹¤.

* íŠ¹ì§•
  - êµ¬ë¶„ ì»¬ëŸ¼ì„ ê¼­ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ `@DiscriminatorColumn`ì„ ê¼­ ì„¤ì •í•´ì•¼í•œë‹¤.
  - `@DiscriminatorValue`ë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ìœ¼ë¡œ ì—”í‹°í‹° ì´ë¦„ì„ ì‚¬ìš©í•œë‹¤.

<br>

### ğŸ”¸ 7.1.3 êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ (TABLE_PER_CLASS)

êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸”ì „ëµì€ ìì‹ ì—”í‹°í‹°ë§ˆë‹¤ í…Œì´ë¸”ì„ ë§Œë“ ë‹¤. <br>

<img width="50%" src="https://velog.velcdn.com/images%2Fcham%2Fpost%2F4c1e96fb-3ca2-4353-87c4-1a2538b2f65a%2Fimage.png">

<br>

```java
@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public abstract class Item {
    @Id @GeneratedValue
    @Column(name = "ITEM_ID")
    private Long id;
    
    private String name;
    private int price;
}

@Entity
public class Album extends Item {}
@Entity
public class Movie extends Item {}
@Entity
public class Book extends Item {}
```


<br>

`InheritanceType.TABLE_PER_CLASS`ë¥¼ ì„ íƒí•˜ë©´ êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµì„ ì‚¬ìš©í•œë‹¤. ì´ ì „ëµì€ ìì‹ ì¸í…Œí…Œë§ˆë‹¤ í…Œì´ë¸”ì„ ë§Œë“ ë‹¤.

<br>

* ì¥ì 
  - ì„œë¸Œ íƒ€ì…ì„ êµ¬ë¶„í•´ì„œ ì²˜ë¦¬í•  ë•Œ íš¨ê³¼ì ì´ë‹¤.
  - not null ì œì•½ì¡°ê±´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

* ë‹¨ì 
  - ì—¬ëŸ¬ ìì‹ í…Œì´ë¸”ì„ í•¨ê»˜ ì¡°íšŒí•  ë•Œ ì„±ëŠ¥ì´ ëŠë¦¬ë‹¤.
  - ìì‹ í…Œì´ë¸”ì„ í†µí•©í•´ì„œ ì¿¼ë¦¬í•˜ê¸° ì–´ë µë‹¤.

* íŠ¹ì§•
  - êµ¬ë¶„ ì»¬ëŸ¼ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

<br>

### âœ… 7.2 @MappedSuperclass

ë¶€ëª¨ í´ë˜ìŠ¤ëŠ” í…Œì´ë¸”ê³¼ ë§¤í•‘í•˜ì§€ ì•Šê³  ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ëŠ” ìì‹ í´ë˜ìŠ¤ì—ê²Œ ë§¤í•‘ ì •ë³´ë§Œ ì œê³µí•˜ê³  ì‹¶ìœ¼ë©´ `@MappedSuperclass`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. <br>

`@MappedSuperclass`ëŠ” ë¹„ìœ ë¥¼ í•˜ìë©´ ì¶”ìƒ í´ë˜ìŠ¤ì™€ ë¹„ìŠ·í•œë° `@Entity`ëŠ” ì‹¤ì œ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ì§€ë§Œ `@MappedSuperclass`ëŠ” ì‹¤ì œ í…Œì´ë¸”ê³¼ëŠ” ë§¤í•‘ë˜ì§€ ì•ŠëŠ”ë‹¤. <br>

<img width="60%" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQAjH3ZVteYc2r2IHYfWNUcKqCtB3k6eyms7nzvEST4xuIdRkqrGi89OhBFDNx0y1fQ1g&usqp=CAU">

<br>

íšŒì›(Member)ê³¼ íŒë§¤ì(Seller)ëŠ” ì„œë¡œ ê´€ê³„ê°€ ì—†ëŠ” í…Œì´ë¸”ê³¼ ì—”í‹°í‹°ë‹¤. <br>
í…Œì´ë¸”ì€ ê·¸ëŒ€ë¡œ ë‘ê³  ê°ì²´ ëª¨ë¸ì˜ id, name ë‘ ê³µí†µ ì†ì„±ì„ ë¶€ëª¨ í´ë˜ìŠ¤ë¡œ ëª¨ìœ¼ê³  ê°ì²´ ìƒì† ê´€ê³„ë¡œ ë§Œë“ ë‹¤ë©´, <br>

```java
@MappedSuperclass
public abstract class BaseEntity{
    @Id @GeneratedValue
    private Long id;
    private String name;
}

@Entity
public class Member extends BaseEntity {
    private String email
}

@Entity
public class Seller extends BaseEntity {
    private String shopName;
}
```

<br>

`BaseEntity`ì—ëŠ” ê°ì²´ë“¤ì´ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê³µí†µ ë§¤í•‘ ì •ë³´ë¥¼ ì •ì˜í–ˆë‹¤. ê·¸ë¦¬ê³  ìì‹ ì—”í‹°í‹°ë“¤ì€ ìƒì†ì„ í†µí•´ ë¬¼ë ¤ë°›ì•˜ë‹¤. <br>
ì—¬ê¸°ì„œ `BaseEntity`ëŠ” í…Œì´ë¸”ê³¼ ë§¤í•‘í•  í•„ìš”ê°€ ì—†ê³  ìì‹ ì—”í‹°í‹°ì—ê²Œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë§¤í•‘ ì •ë³´ë§Œ ì œê³µí•˜ë©´ ëœë‹¤. ë”°ë¼ì„œ `@MappedSuperclass`ë¥¼ ì‚¬ìš©í–ˆë‹¤. <br>

ë¶€ëª¨ë¡œë¶€í„° ë¬¼ë ¤ë°›ì€ ë§¤í•‘ ì •ë³´ë¥¼ ì¬ì •ì˜í•˜ê³ ì í•œë‹¤ë©´, <br>

```java
// ë¶€ëª¨ì—ê²Œ ìƒì†ë°›ì€ id ì†ì„±ì˜ ì»¬ëŸ¼ëª…ì„ MEMBER_IDë¡œ ì¬ì •ì˜í–ˆë‹¤.
@Entity
@AttributeOverride(name = "id", column = @Column(name = "MEMBER_ID"))
public class Member extends BaseEntity {}

// ë‘˜ ì´ìƒì„ ì¬ì •ì˜í•˜ë ¤ë©´,
@Entity
@AttributeOverrides({
        @AttributeOverride(name = "id", column = @Column(name = "MEMBER_ID")),
        @AttributeOverride(name = "name", column = @Column(name = "MEMBER_NAME"))
})
public class Member extends BaseEntity {}
```

<br>

`@MappedSuperclass`ì˜ íŠ¹ì§• <br>

1. í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ì§€ ì•Šê³  ìì‹ í´ë˜ìŠ¤ì— ì—”í‹°í‹°ì˜ ë§¤í•‘ ì •ë³´ë¥¼ ìƒì†í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.
2. `@MappedSuperclass`ë¡œ ì§€ì •í•œ í´ë˜ìŠ¤ëŠ” ì—”í‹°í‹°ê°€ ì•„ë‹ˆë¯€ë¡œ `em.find()`ë‚˜ JPQLì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
3. ì´ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ìƒì„±í•´ì„œ ì‚¬ìš©í•  ì¼ì€ ê±°ì˜ ì—†ìœ¼ë¯€ë¡œ ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ë§Œë“œëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

<br>

### âœ… 7.3 ë³µí•© í‚¤ì™€ ì‹ë³„ ê´€ê³„ ë§¤í•‘

ë³µí•© í‚¤(Composite Key)ë€? <br>
ë°ì´í„°ë¥¼ ëŒ€í‘œí•˜ëŠ” í‚¤ê°€ ì—¬ëŸ¬ ê°œì˜ ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ì„±ëœ ê²ƒì„ ì˜ë¯¸ <br>

#### ğŸ”¸ 7.3.1 ì‹ë³„ ê´€ê³„ vs ë¹„ì‹ë³„ ê´€ê³„

ì‹ë³„ ê´€ê³„ë€? <br>
ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë‚´ë ¤ë°›ì•„ì„œ ìì‹ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ + ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•˜ëŠ” ê´€ê³„ <br>

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FUcYEB%2FbtrcxIl3q3e%2FK2ho5ldNfB7bLHY5nwogf1%2Fimg.png">

<br>

ë¹„ì‹ë³„ ê´€ê³„? <br>
ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë°›ì•„ì„œ ìì‹ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¡œë§Œ ì‚¬ìš©í•˜ëŠ” ê´€ê³„ë‹¤. <br>

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbY65d3%2FbtrcxJSNJPp%2FtsqItpYgTUevogCt2UXYW0%2Fimg.png">

#### ğŸ”¸ 7.3.2 ë³µí•© í‚¤: ë¹„ì‹ë³„ ê´€ê³„ ë§¤í•‘

```java
@Entity
public class Hello {
    @Id
    private String id1;
    @Id
    private String id2;
    // Composite-id class must implement Serializable ì—ëŸ¬ ë°œìƒ
}
```

ë‘˜ ì´ìƒì˜ ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ì„±ëœ ë³µí•© ê¸°ë³¸ í‚¤ëŠ” ë‹¤ìŒì²˜ëŸ¼ ë§¤í•‘í•˜ë©´ ë  ê²ƒ ê°™ì§€ë§Œ ë§‰ìƒ í•´ë³´ë©´ ë§¤í•‘ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. <br>
JPAì—ì„œ ì‹ë³„ìë¥¼ ë‘˜ ì´ìƒ ì‚¬ìš©í•˜ë ¤ë©´ ë³„ë„ì˜ ì‹ë³„ì í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤. <br>

* `@IdClass` 

<br>


<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbXO4fd%2FbtrctuWppkV%2FjvyQBkXBguGRV98fQqJw2k%2Fimg.png">

<br>

PARENT í…Œì´ë¸”ì„ ë³´ë©´ ê¸°ë³¸ í‚¤ë¥¼ PARENT_ID1, PARENT_ID2ë¡œ ë¬¶ì€ ë³µí•© í‚¤ë¡œ êµ¬ì„± <br>

```java
@Entity
@IdClass(ParentId.class)
public class Parent {
    @Id
    @Column(name = "PARENT_ID1")
    private String id1;
    
    @Id
    @Column(name = "PARENT_ID2")
    private String id2;
    
    private String name;
}

@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@EqualsAndHashCode
public class ParentId implements Serializable {
    private String id1;
    private String id2;
}
```

`@IdClass`ë¥¼ ì‚¬ìš©í•  ë•Œ ì‹ë³„ì í´ë˜ìŠ¤ëŠ” ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•œë‹¤. <br>

1. ì‹ë³€ì í´ë˜ìŠ¤ì˜ ì†ì„±ëª…ê³¼ ì—”í‹°í‹°ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì‹ë³„ìì˜ ì†ì„±ëª…ì´ ê°™ì•„ì•¼ í•œë‹¤.
2. `Serializable` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
3. `equals`,`hashCode`ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
4. ê¸°ë³¸ ìƒì„±ìê°€ ìˆì–´ì•¼ í•œë‹¤.
5. ì‹ë³„ì í´ë˜ìŠ¤ëŠ” public ì´ì–´ì•¼ í•œë‹¤.

<br>

```java
@Test
void idClassTest(){
    // given
    Parent parent = new Parent();
    parent.setId1("id1");
    parent.setId2("id2");
    parent.setName("parentName");
    em.persist(parent);

    // when
    ParentId parentId = new ParentId("id1", "id2");
    Parent findParent = em.find(Parent.class, parentId);

    // then
    assertThat(parent).isEqualTo(findParent);
}
```

<br>

ì´ì œ `Child`ë¥¼ ì¶”ê°€ <br>

````java
@Entity
public class Child {
    @Id
    private String id;

    @ManyToOne
    @JoinColumns({
            @JoinColumn(name = "PARENT_ID1", referencedColumnName = "PARENT_ID1"),
            @JoinColumn(name = "PARENT_ID2", referencedColumnName = "PARENT_ID2")
    })
    private Parent parent;
}
````

ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ì´ ë³µí•© í‚¤ì´ë¯€ë¡œ ìì‹ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë„ ë³µí•© í‚¤ì´ë‹¤. <br>
ë”°ë¼ì„œ ì™¸ë˜ í‚¤ ë§¤í•‘ ì‹œ ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ë§¤í•‘í•´ì•¼ í•˜ë¯€ë¡œ `@JoinColumns`ë¥¼ ì‚¬ìš©í•˜ê³  ê°ê° ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì„ `@JoinColumn`ìœ¼ë¡œ ë§¤í•‘í•œë‹¤. <br>

<br>

* `@EmbeddedId` <br>

`@IdClass`ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ì¶˜ ë°©ë²•ì´ë¼ë©´ `@EmbeddedId`ëŠ” ì¢€ ë” ê°ì²´ì§€í–¥ì ì¸ ë°©ë²• <br>

```java
@Entity
public class ParentV2 {

  @EmbeddedId
  private ParentIdV2 id;

  private String name;

}
@Embeddable
@EqualsAndHashCode
public class ParentIdV2 implements Serializable {

    @Column(name = "PARENT_ID1")
    private String id1;

    @Column(name = "PARENT_ID2")
    private String id2;
}
```

`@IdClass`ì™€ëŠ” ë‹¤ë¥´ê²Œ `@EmbeddedId`ë¥¼ ì ìš©í•œ ì‹ë³„ì í´ë˜ìŠ¤ëŠ” ì‹ë³„ìì— ê¸°ë³¸ í‚¤ë¥¼ ì§ì ‘ ë§¤í•‘í•œë‹¤. <br>
`@EmbeddedId`ë¥¼ ì ìš©í•œ ì‹ë³„ì í´ë˜ìŠ¤ëŠ” ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•œë‹¤. <br>

1. `@EmbeddedId`ë¥¼ ë¶™ì—¬ì£¼ì–´ì•¼ í•œë‹¤.
2. `Serializable` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
3. `equals`, `hashCode`ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
4. ê¸°ë³¸ ìƒì„±ìê°€ ìˆì–´ì•¼ í•œë‹¤.
5. ì‹ë³„ì í´ë˜ìŠ¤ëŠ” public ì´ì–´ì•¼ í•œë‹¤.

<br>

```java
@Test
void embeddedIdTest(){
    // given
    ParentV2 parentV2 = new ParentV2();
    ParentIdV2 idV2 = new ParentIdV2("id1", "id2");
    parentV2.setId(idV2);
    parentV2.setName("parentV2Name");
    em.persist(parentV2);

    // when
    ParentIdV2 parentId = new ParentIdV2("id1", "id2");
    ParentV2 findParentV2 = em.find(ParentV2.class, parentId);

    // then
    assertThat(parentV2).isEqualTo(findParentV2);
}
```

<br>

* ë³µí•© í‚¤ì™€ equals(), hashCode()

ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì—”í‹°í‹°ì˜ ì‹ë³„ìë¥¼ í‚¤ë¡œ ì‚¬ìš©í•´ì„œ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•œë‹¤. ê·¸ë¦¬ê³  ì‹ë³„ìë¥¼ ë¹„êµí•  ë•Œ `equals`, `hashCode`ë¥¼ ì‚¬ìš©í•œë‹¤. <br>
ë”°ë¼ì„œ, ì‹ë³„ì ê°ì²´ì˜ ë™ë“±ì„±ì´ ì§€ì¼œì§€ì§€ ì•Šìœ¼ë©´ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì—”í‹°í‹°ê°€ ì¡°íšŒë˜ê±°ë‚˜ ì—”í‹°í‹°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ë“± ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. <br>

<br>

* `@IdClass` vs `@EmbeddedId` <br>

ê°ê° ì¥ë‹¨ì ì´ ìˆìœ¼ë¯€ë¡œ ë³¸ì¸ì˜ ì·¨í–¥ì— ë§ëŠ” ê²ƒì„ ì¼ê´€ì„± ìˆê²Œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. <br>
`@EmbeddedId`ê°€ `@IdClass`ì™€ ë¹„êµí•´ì„œ ë” ê°ì²´ì§€í–¥ì ì´ê³  ì¤‘ë³µë„ ì—†ì–´ì„œ ì¢‹ì•„ë³´ì´ê¸´ í•˜ì§€ë§Œ íŠ¹ì • ìƒí™©ì— JPQLì´ ì¡°ê¸ˆ ë” ê¸¸ì–´ì§ˆ ìˆ˜ ìˆë‹¤. <br>

<br>

#### ğŸ”¸ 7.3.3 ë³µí•© í‚¤: ì‹ë³„ ê´€ê³„ ë§¤í•‘

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FxZ0Ce%2FbtrcxH8vkL2%2FzhmWGGbhYxfVcGTppf1HVk%2Fimg.png">

<br>

ë¶€ëª¨, ìì‹, ì†ìê¹Œì§€ ê³„ì† ê¸°ë³¸ í‚¤ë¥¼ ì „ë‹¬í•˜ëŠ” ì‹ë³„ ê´€ê³„ì—ì„œ ìì‹ í…Œì´ë¸”ì€ ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ í¬í•¨í•´ì„œ ë³µí•© í‚¤ë¥¼ êµ¬ì„±í•´ì•¼ í•˜ë¯€ë¡œ <br>
`@IdClass`ë‚˜ `@EmbeddedId`ë¥¼ ì‚¬ìš©í•´ì„œ ì‹ë³„ìë¥¼ ë§¤í•‘í•´ì•¼ í•œë‹¤.<br>

* `@IdClass`ë¥¼ ì´ìš©í•œ ë§¤í•‘ <br>

```java
@Data
@Entity
public class ParentV3 {

    @Id
    @Column(name = "PARENT_ID")
    private String id;
    private String name;
}

@Entity
@IdClass(ChildIdV3.class)
public class ChildV3 {

    @Id
    @ManyToOne
    @JoinColumn(name = "PARENT_ID")
    public ParentV3 parentV3;
  
    @Id
    @Column(name = "CHILD_ID")
    private String childId;
  
    private String name;
}

@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
public class ChildIdV3 implements Serializable {
    private ParentV3 parentV3;
    private String childId;
}

@Entity
@IdClass(GrandChildId.class)
public class GrandChild {

    @Id
    @ManyToOne
    @JoinColumns({
            @JoinColumn(name = "PARENT_ID"),
            @JoinColumn(name = "CHILD_ID")
    })
    private ChildV3 childV3;
  
    @Id
    @Column(name = "GRANDCHILD_ID")
    private String id;
  
    private String name;
}

@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
public class GrandChildId implements Serializable {
    private ChildV3 childV3;
    private String id;
}
```

<br>

* `@EmbeddedId`ë¥¼ ì´ìš©í•œ ë§¤í•‘ <br>

````java
@Entity
public class ParentV4 {
    
    @Id @Column(name = "PARENT_ID")
    private String id;
    
    private String name;
}

@Entity
public class ChildV4 {

    @EmbeddedId
    private ChildIdV4 id;
  
    @MapsId("parentId")
    @ManyToOne
    @JoinColumn(name = "PARENT_ID")
    public ParentV4 parentV4;
}

@EqualsAndHashCode
@NoArgsConstructor
@AllArgsConstructor
@Embeddable
public class ChildIdV4 implements Serializable {

    private String parentId;
  
    @Column(name = "CHILD_ID")
    private String id;
}

@Entity
public class GrandChildV2 {

    @EmbeddedId
    private GrandChildIdV2 id;
  
    @MapsId("childId")
    @ManyToOne
    @JoinColumns({
            @JoinColumn(name = "PARENT_ID"),
            @JoinColumn(name = "CHILD_ID")
    })
    private ChildV4 childId;
  
    private String name;
}

@EqualsAndHashCode
@Embeddable
public class GrandChildIdV2 implements Serializable {
    private ChildIdV4 childId;
  
    @Column(name = "GRANDCHILD_ID")
    private String id;
}
````

`@EmbeddedId`ëŠ” ì‹ë³„ ê´€ê³„ë¡œ ì‚¬ìš©í•  ì—°ê´€ê´€ê³„ì˜ ì†ì„±ì— `@MapsId`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. <br>

<br>

#### ğŸ”¸ 7.3.4 ë¹„ì‹ë³„ ê´€ê³„ë¡œ êµ¬í˜„

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FmSE3P%2Fbtrcp0IycY3%2FHNexDN2V1Hi6sCFiZS7u50%2Fimg.png">

<br>

````java
@Entity
public class Parent {
    @Id @GeneratedValue
    @Column(name = "PARENT_ID")
    private Long id;
    private String name;
}

@Entity
public class Child {
    @Id @GeneratedValue
    @Column(name = "CHILD_ID")
    private Long id;
    private String name;
    
    @ManyToOne
    @JoinColumn(name = "PARENT_ID")
    private Parent parent;
}

@Entity
public class GrandChild {
    @Id @GeneratedValue
    @Column(name = "GRANDCHILD_ID")
    private Long id;
    private String name;
    
    @ManyToOne
    @JoinColumn(name = "CHILD_ID")
    private Child child;
}
````

ì‹ë³„ ê´€ê³„ì˜ ë³µí•© í‚¤ë¥¼ ì‚¬ìš©í•œ ì½”ë“œì™€ ë¹„êµí•˜ë©´ ë§¤í•‘ë„ ì‰½ê³  ì½”ë“œë„ ë‹¨ìˆœí•˜ë‹¤. ê·¸ë¦¬ê³  ë³µí•© í‚¤ê°€ ì—†ìœ¼ë¯€ë¡œ ë³µí•© í‚¤ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì§€ ì•Šì•„ë„ ëœë‹¤. <br>

<br>


#### ğŸ”¸ 7.3.5 ì¼ëŒ€ì¼ ì‹ë³„ ê´€ê³„

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fqrvnk%2FbtrcoktKq5M%2Fdb7NjVu4a5qbijLNWcQbRk%2Fimg.png">

<br>

````java
@Entity
public class Board {
    @Id @GeneratedValue
    @Column(name = "BOARD_ID")
    private Long id;
    
    private String title;
    
    @OneToOne(mappedBy = "board")
    private BoardDetail boardDetail;
}
@Entity
public class BoardDetail {
    @Id
    private Long boardId;
    
    @MapsId
    @OneToOne
    @JoinColumn(name = "BOARD_ID")
    private Board board;
    
    private String content;
}
````

`BoardDetail`ì²˜ëŸ¼ ì‹ë³„ìê°€ ë‹¨ìˆœíˆ ì»¬ëŸ¼ í•˜ë‚˜ë©´ `@MapsId`ë¥¼ ì‚¬ìš©í•˜ê³  ì†ì„± ê°’ì€ ë¹„ì›Œë‘ë©´ ëœë‹¤. <br>
ì´ë•Œ `@MapsId`ëŠ” `@Id`ë¥¼ ì‚¬ìš©í•´ì„œ ì‹ë³„ìë¡œ ì§€ì •í•œ `BoardDetail.boardId`ì™€ ë§¤í•‘ëœë‹¤. <br>

<br>

#### ğŸ”¸ 7.3.6 ì‹ë³„, ë¹„ì‹ë³„ ê´€ê³„ì˜ ì¥ë‹¨ì 

ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ê´€ì ì—ì„œ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ë¡œ ì‹ë³„ ê´€ê³„ë³´ë‹¤ëŠ” ë¹„ì‹ë³„ ê´€ê³„ë¥¼ ì„ í˜¸í•œë‹¤. <br>

1. ì‹ë³„ ê´€ê³„ëŠ” ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ìì‹ í…Œì´ë¸”ë¡œ ì „íŒŒí•˜ë©´ì„œ ìì‹ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ì´ ì ì  ëŠ˜ì–´ë‚œë‹¤.
2. ì‹ë³„ ê´€ê³„ëŠ” 2ê°œ ì´ìƒì˜ ì»¬ëŸ¼ì„ í•©í•´ì„œ ë³µí•© ê¸°ë³¸ í‚¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.
3. ì‹ë³„ ê´€ê³„ë¥¼ ì‚¬ìš©í•  ë•Œ ê¸°ë³¸ í‚¤ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë¯¸ê°€ ìˆëŠ” ìì—° í‚¤ ì»¬ëŸ¼ì„ ì¡°í•©í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤. ë°˜ë©´ì— ë¹„ì‹ë³„ ê´€ê³„ì˜ ê¸°ë³¸ í‚¤ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ì „í˜€ ê´€ê³„ì—†ëŠ” ëŒ€ë¦¬ í‚¤ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.
4. ì‹ë³„ ê´€ê³„ëŠ” ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ìì‹ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¡œ ì‚¬ìš©í•˜ë¯€ë¡œ ë¹„ì‹ë³„ ê´€ê³„ë³´ë‹¤ í…Œì´ë¸” êµ¬ì¡°ê°€ ìœ ì—°í•˜ì§€ ëª»í•˜ë‹¤.
5. ì¼ëŒ€ì¼ ê´€ê³„ë¥¼ ì œì™¸í•˜ê³  ì‹ë³„ ê´€ê³„ëŠ” 2ê°œ ì´ìƒì˜ ì»¬ëŸ¼ì„ ë¬¶ì€ ë³µí•© ê¸°ë³¸ í‚¤ë¥¼ ì‚¬ìš©í•œë‹¤. JPAì—ì„œ ë³µí•© í‚¤ëŠ” ë³„ë„ì˜ ë³µí•© í‚¤ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
6. ë¹„ì‹ë³„ ê´€ê³„ì˜ ê¸°ë³¸ í‚¤ëŠ” ì£¼ë¡œ ëŒ€ë¦¬ í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° JPAëŠ” `@GeneratedValue`ì²˜ëŸ¼ ëŒ€ë¦¬ í‚¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ í¸ë¦¬í•œ ë°©ë²•ì„ ì œê³µí•œë‹¤.

ë¬¼ë¡  ì‹ë³„ ê´€ê³„ê°€ ê°€ì§€ëŠ” ì¥ì ë„ ìˆë‹¤. ê¸°ë³¸ í‚¤ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ê¸° ì¢‹ê³ , ìƒìœ„ í…Œì´ë¸”ë“¤ì˜ ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ì„ ìì‹, ì†ì í…Œì´ë¸”ë“¤ì´ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ <br>
íŠ¹ì • ìƒí™©ì— ì¡°ì¸ ì—†ì´ í•˜ìœ„ í…Œì´ë¸”ë§Œìœ¼ë¡œ ê²€ìƒ‰ì„ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤. <br>

> ë‚´ìš©ì„ ì •ë¦¬í•˜ìë©´ ORM ì‹ ê·œ í”„ë¡œì íŠ¸ ì§„í–‰ì‹œ ë  ìˆ˜ ìˆìœ¼ë©´ ë¹„ì‹ë³„ ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ê³  ê¸°ë³¸ í‚¤ëŠ” Long íƒ€ì…ì˜ ëŒ€ë¦¬ í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. (IntegerëŠ” 20ì–µì •ë„ë©´ ëë‚˜ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŒ) <br>

<br>

### âœ… 7.4 ì¡°ì¸ í…Œì´ë¸”

ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ê³„í•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ 2ê°€ì§€ ì´ë‹¤. <br>

1. ì¡°ì¸ ì»¬ëŸ¼ ì‚¬ìš© (ì™¸ë˜ í‚¤)
2. ì¡°ì¸ í…Œì´ë¸” ì‚¬ìš© (í…Œì´ë¸” ì‚¬ìš©)

<br>

* ì¡°ì¸ ì»¬ëŸ¼ ì‚¬ìš© <br>

í…Œì´ë¸” ê°„ì— ê´€ê³„ëŠ” ì£¼ë¡œ ì¡°ì¸ ì»¬ëŸ¼ì´ë¼ ë¶€ë¥´ëŠ” ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì„ ì‚¬ìš©í•´ì„œ ê´€ë¦¬í•œë‹¤. <br>

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbiCRxW%2Fbtrcs8MPEds%2FZyIs54HRKt4OakLNVqI9O1%2Fimg.png">

<br>

1. ë¼ì»¤ë¥¼ ì„ íƒì ìœ¼ë¡œ ì…ë ¥ ë°›ëŠ” ìƒí™©ì—ì„œ ì™¸ë˜ í‚¤ì— nullì„ í—ˆìš©í•˜ëŠ” ê´€ê³„ë¥¼ ì„ íƒì  ë¹„ì‹ë³„ ê´€ê³„ë¼ í•œë‹¤.
2. ì„ íƒì  ë¹„ì‹ë³„ ê´€ê³„ëŠ” ì™¸ë˜ í‚¤ì— nullì„ í—ˆìš©í•˜ë¯€ë¡œ outer joinì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
3. ê´€ê³„ë¥¼ ë§ºëŠ” ì¼ì´ ì ë‹¤ë©´ ì™¸ë˜ í‚¤ ê°’ ëŒ€ë¶€ë¶„ì´ nullë¡œ ì…ë ¥

<br>

* ì¡°ì¸ í…Œì´ë¸” ì‚¬ìš© <br>

ì¡°ì¸ ì»¬ëŸ¼ì„ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ ì— ì¡°ì¸ í…Œì´ë¸”ì„ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•œë‹¤. <br>

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FP4lUN%2FbtrcgP8V9nB%2FIfgMEHNX19H5RTCfmxOK5k%2Fimg.png">

<br>

1. ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¡°ì¸ í…Œì´ë¸”(MEMBER_LOCKER)ì„ ì¶”ê°€í•˜ê³  ì—¬ê¸°ì—ì„œ ê´€ë¦¬
2. ê´€ë¦¬í•˜ëŠ” ì¡°ì¸ í…Œì´ë¸” í•˜ë‚˜ ì¶”ê°€ì™€ ì¡°íšŒì‹œ ì¡°ì¸ íšŸìˆ˜ ì¦ê°€ë¼ëŠ” ë‹¨ì ì´ ìˆìŒ
3. ì¡°ì¸ í…Œì´ë¸”ì€ ì£¼ë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ê¸°ìœ„í•´ ì‚¬ìš©, ê·¸ë ‡ì§€ë§Œ ì¼ëŒ€ì¼, ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ì—ì„œë„ ì‚¬ìš©í•œë‹¤.

<br>

#### ğŸ”¸ 7.4.1 ì¼ëŒ€ì¼ ì¡°ì¸ í…Œì´ë¸”

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcrSPQK%2Fbtrcp1AH3OO%2FBCUQiq82NKtE2wwMBDS3Dk%2Fimg.png">

ì¼ëŒ€ì¼ ê´€ê³„ë¥¼ ë§Œë“¤ë ¤ë©´ ì¡°ì¸ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ ì»¬ëŸ¼ ê°ê°ì— ì´ 2ê°œì˜ ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´ì„ ê±¸ì–´ì•¼ í•œë‹¤. <br>

````java
@Entity
public class Parent {
    @Id @GeneratedValue
    @Column(name = "PARENT_ID")
    private Long id;
    private String name;
    
    @OneToOne
    @JoinTable(name = "PARENT_CHILD",
            joinColumns = @JoinColumn(name = "PARENT_ID"),
            inverseJoinColumns = @JoinColumn(name = "CHILD_ID")
    )
    private Child child;
}

@Entity
public class Child {
    
    @Id @GeneratedValue
    @Column(name = "CHILD_ID")
    private Long id;
    private String name;
}
````

ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ë³´ë©´ `@JoinTable`ì„ ì‚¬ìš©í–ˆë‹¤. `@JoinTable`ì˜ ì†ì„±ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. <br>

+ name : ë§¤í•‘í•  ì¡°ì¸ í…Œì´ë¸” ì´ë¦„
+ joinColumns : í˜„ì¬ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ëŠ” ì™¸ë˜ í‚¤
+ inverseJoinColumns : ë°˜ëŒ€ë°©í–¥ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ëŠ” ì™¸ë˜ í‚¤

<br>

if. ì–‘ë°©í–¥ìœ¼ë¡œ ë§¤í•‘í•˜ê³  ì‹¶ë‹¤ë©´? <br>

````java
public class Child {
    // ... ìƒëµ
  
    // ì¶”ê°€
    @OneToOne(mappedBy = "child")
    private Parent parent;
}
````

<br>

#### ğŸ”¸ 7.4.2 ì¼ëŒ€ë‹¤ ì¡°ì¸ í…Œì´ë¸”

ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë§Œë“¤ë ¤ë©´ CHILD_IDì— ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ì„ ê±¸ì–´ì•¼ í•œë‹¤. <br>

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F2Aqbb%2FbtrcqydI2Eb%2F1qpk3gboixTHXciSJfkVS1%2Fimg.png">

<br>


````java
@Entity
public class Parent {
    @Id @GeneratedValue
    @Column(name = "PARENT_ID")
    private Long id;
    private String name;
    
    @OneToMany
    @JoinTable(name = "PARENT_CHILD",
            joinColumns = @JoinColumn(name = "PARENT_ID"),
            inverseJoinColumns = @JoinColumn(name = "CHILD_ID")
    )
    private List<Child> children = new ArrayList<>();
}

@Entity
public class Child {
    @Id @GeneratedValue
    @Column(name = "CHILD_ID")
    private Long id;
    private String name;
    // ...    
}
````

<br>

#### ğŸ”¸ 7.4.3 ë‹¤ëŒ€ì¼ ì¡°ì¸ í…Œì´ë¸”

ë‹¤ëŒ€ì¼ì€ ì¼ëŒ€ë‹¤ì—ì„œ ë°©í–¥ë§Œ ë°˜ëŒ€ <br>


````java
@Entity
public class Parent {
    @Id @GeneratedValue
    @Column(name = "PARENT_ID")
    private Long id;
    private String name;
    
    @OneToMany(mappedBy = "parent")
    private List<Child> children = new ArrayList<>();
}

@Entity
public class Child {
    @Id @GeneratedValue
    @Column(name = "CHILD_ID")
    private Long id;
    private String name;
    
    @ManyToOne(optional = false)
    @JoinTable(name = "PARENT_CHILD",
            joinColumns = @JoinColumn(name = "CHILD_ID"),
            inverseJoinColumns = @JoinColumn(name = "PARENT_ID")
    )
    private Parent parent;
}
````

<br>

#### ğŸ”¸ 7.4.4 ë‹¤ëŒ€ë‹¤ ì¡°ì¸ í…Œì´ë¸”

ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë§Œë“¤ë ¤ë©´ ì¡°ì¸ í…Œì´ë¸”ì˜ ë‘ ì»¬ëŸ¼ì„ í•©í•´ì„œ í•˜ë‚˜ì˜ ë³µí•© ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ì„ ê±¸ì–´ì•¼ í•œë‹¤. <br>

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FmPJal%2FbtrcusD4tXD%2F7HYIvIQqlwpUKrPcWhC531%2Fimg.png">

<br>

```java
//ë¶€ëª¨
@Entity
public class Parent {
    @Id @GeneratedValue
    @Column(name = "PARENT_ID")
    private Long id;
    private String name;
  
    @ManyToMany
    @JoinTable(name = "PARENT_CHILD",
            joinColumns = @JoinColumn(name = "PARENT_ID"),
            inverseJoinColumns = @JoinColumn(name = "CHILD_ID"))
    private List<Child> children = new ArrayList<>();
}

//ìì‹
@Entity
public class Child {
    @Id @GeneratedValue
    @Column(name = "CHILD_ID")
    private Long id;
    private String name;
}
```

<br>

### âœ… 7.5 ì—”í‹°í‹° í•˜ë‚˜ì— ì—¬ëŸ¬ í…Œì´ë¸” ë§¤í•‘

ì˜ ì‚¬ìš©í•˜ì§€ëŠ” ì•Šì§€ë§Œ `@SecondaryTable`ì„ ì‚¬ìš©í•˜ë©´ í•œ ì—”í‹°í‹°ì— ì—¬ëŸ¬ í…Œì´ë¸”ì„ ë§¤í•‘í•  ìˆ˜ ìˆë‹¤. <br>

<img width="50%" src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FexoxIs%2FbtrctuWpOrB%2Fx0rKBolnf0glQDihcbm3u0%2Fimg.png">

<br>

````java
@Entity
@Table(name = "BOARD")
@SecondaryTable(name = "BOARD_DETAIL",
            pkJoinColumns = @PrimaryKeyJoinColumn(name = "BOARD_DETAIL_ID"))
public class Board {
    @Id @GeneratedValue
    @Column(name = "BOARD_ID")
    private Long id;
    
    private String title;
    
    @Column(table = "BOARD_DETAIL")
    private String content;
}
````

Board ì—”í‹°í‹°ëŠ” `@Table`ì„ ì‚¬ìš©í•´ì„œ BOARD í…Œì´ë¸”ê³¼ ë§¤í•‘í–ˆë‹¤. ê·¸ë¦¬ê³  `@SecondaryTable`ì„ ì‚¬ìš©í•´ì„œ BOARD_DETAIL í…Œì´ë¸”ì„ ì¶”ê°€ë¡œ ë§¤í•‘í–ˆë‹¤. <br>

`@SecondaryTable` ì†ì„±ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. <br>

+ `@SecondaryTable.name` : ë§¤í•‘í•  ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ì´ë¦„
+ `@SecondaryTable.pkJoinColumns` : ë§¤í•‘í•  ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ ì†ì„±

<br>

ë” ë§ì€ í…Œì´ë¸”ì„ ë§¤í•‘í•˜ë ¤ë©´ `@SecondaryTables`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. <br>

```java
@SecondaryTables({
        @SecondaryTable(name="BOARD_DETAIL"),
        @SecondaryTable(name="BOARD_FILE")
})
```

ì°¸ê³ ë¡œ `@SecondaryTable`ì„ ì‚¬ìš©í•´ì„œ ë‘ í…Œì´ë¸”ì„ í•˜ë‚˜ì˜ ì—”í‹°í‹°ì— ë§¤í•‘í•˜ê¸° ë³´ë‹¤ëŠ” í…Œì´ë¸”ë‹¹ ì—”í‹°í‹°ë¥¼ ê°ê° ë§Œë“¤ê¸°ë¥¼ ê¶Œì¥í•œë‹¤. <br>
ì´ ë°©ë²•ì€ í•­ìƒ ë‘ í…Œì´ë¸”ì„ ì¡°íšŒí•˜ë¯€ë¡œ ìµœì í™”í•˜ê¸° ì–´ë µë‹¤. <br>